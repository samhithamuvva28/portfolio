
---
import Section from "./Section.astro";
import catelytics from "../assets/catelytics.png";

const slugMap = {
  React: "react",
  "Node.js": "nodedotjs",
  PostgreSQL: "postgresql",
  Python: "python",
  FastAPI: "fastapi",
  Docker: "docker",
  Astro: "astro",
  Tailwind: "tailwindcss",
  TypeScript: "typescript",
  "Apache Spark": "apachespark",
  Databricks: "databricks",
  AWS: "amazonaws",
  Weaviate: "weaviate",
};

const iconUrl = (name: string) => `https://cdn.simpleicons.org/${slugMap[name] ?? name.toLowerCase()}`;

const projects = [
  {
    id: "catelytics",
    title: "Catelytics: A Review-Driven Categorization",
    href: "https://github.com/samhithamuvva28/CateLytics",
    image: catelytics.src,
    techs: ["Python", "Apache Spark", "Databricks", "AWS", "Weaviate"],
    bullets: [
      "Distributed data processing with Apache Spark on Databricks",
      "Vector search and retrieval with Weaviate",
      "AWS-based infrastructure and data orchestration",
    ],
  },
  {
    id: "project-two",
    title: "Project Two",
    href: "https://github.com/USERNAME/project-two",
    image: "https://via.placeholder.com/800x600?text=Project+Two",
    techs: ["Python", "FastAPI", "Docker"],
    bullets: [
      "FastAPI microservice architecture",
      "Dockerized with multi-stage builds",
      "Async I/O and typed endpoints",
    ],
  },
  {
    id: "project-three",
    title: "Project Three",
    href: "https://github.com/USERNAME/project-three",
    image: "https://via.placeholder.com/800x600?text=Project+Three",
    techs: ["Astro", "Tailwind", "TypeScript"],
    bullets: [
      "Static-first site with islands",
      "Accessible components",
      "Image optimization",
    ],
  },
  {
    id: "project-four",
    title: "Project Four",
    href: "https://github.com/USERNAME/project-four",
    image: "https://via.placeholder.com/800x600?text=Project+Four",
    techs: ["React", "TypeScript"],
    bullets: [
      "Component library with Storybook",
      "Unit tests with Jest/RTL",
      "Tree-shaking friendly",
    ],
  },
  {
    id: "project-five",
    title: "Project Five",
    href: "https://github.com/USERNAME/project-five",
    image: "https://via.placeholder.com/800x600?text=Project+Five",
    techs: ["Python", "Docker"],
    bullets: [
      "ETL pipeline with retries",
      "Containerized workers",
      "Structured logging",
    ],
  },
  {
    id: "project-six",
    title: "Project Six",
    href: "https://github.com/USERNAME/project-six",
    image: "https://via.placeholder.com/800x600?text=Project+Six",
    techs: ["Node.js", "PostgreSQL"],
    bullets: [
      "Queue-based processing",
      "Transactional writes",
      "Metrics and alerts",
    ],
  },
];
---
<Section id="projects" title="What Iâ€™ve Done">
  <div class="mt-6 grid gap-6 sm:grid-cols-2 lg:grid-cols-3 mx-auto">
    {projects.map((p) => (
      <div class="group block overflow-hidden rounded-xl border border-zinc-200 bg-white">
        <div class="aspect-[4/3] overflow-hidden bg-zinc-100">
          <img src={p.image} alt={p.title} class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105" loading="lazy" decoding="async" />
        </div>
        <div class="p-4">
          <h3 class="font-semibold text-center">{p.title}</h3>
          <div class="mt-3 flex flex-wrap items-center gap-2">
            {p.techs.map((t) => (
              <span class="inline-flex items-center gap-1 rounded-md bg-zinc-100 px-2 py-0.5 text-xs text-zinc-700">
                {slugMap[t] && (
                  <img src={iconUrl(t)} alt={`${t} logo`} width="16" height="16" class="inline-block h-4 w-4 align-middle object-contain shrink-0" loading="lazy" decoding="async" onerror="this.style.display='none'" />
                )}
                {t}
              </span>
            ))}
          </div>
          <div class="mt-4 flex items-center gap-3">
            <button type="button" data-open-modal={`modal-${p.id}`} class="rounded-md border border-zinc-300 px-3 py-1.5 text-sm hover:border-[#15543c] hover:text-[#15543c]">Details</button>
            <a href={p.href} target="_blank" rel="noopener noreferrer" class="rounded-md bg-[#15543c] px-3 py-1.5 text-sm text-white hover:opacity-90">GitHub</a>
          </div>
        </div>
      </div>
    ))}
  </div>

  {/* Modals */}
  {projects.map((p) => (
    <div id={`modal-${p.id}`} class="fixed inset-0 z-50 hidden" aria-hidden="true">
      <div class="absolute inset-0 bg-black/50" data-close-modal={`modal-${p.id}`}></div>
      <div class="relative mx-auto my-10 w-[92%] max-w-xl rounded-xl bg-white p-6 shadow-lg">
        <div class="flex items-center justify-between gap-3">
          <h3 class="text-lg font-semibold">{p.title}</h3>
          <button type="button" aria-label="Close" class="inline-flex items-center justify-center rounded-md p-1.5 text-zinc-600 hover:text-zinc-900 hover:bg-zinc-100" data-close-modal={`modal-${p.id}`}>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <ul class="mt-4 list-disc space-y-2 pl-5 text-sm text-zinc-700">
          {p.bullets.map((b) => <li>{b}</li>)}
        </ul>
        <div class="mt-6 flex justify-end gap-3">
          <a href={p.href} target="_blank" rel="noopener noreferrer" class="rounded-md bg-[#15543c] px-3 py-1.5 text-sm text-white hover:opacity-90">View on GitHub</a>
        </div>
      </div>
    </div>
  ))}
</Section>

<style is:global>
  section#projects > h2 { text-align: center; }
  section#projects > div { margin-left: auto; margin-right: auto; }
  @media (min-width: 1024px) {
    section#projects > div { max-width: 72rem; }
  }
</style>

<script is:inline>
  (function(){
    const openers = document.querySelectorAll('[data-open-modal]');
    function openModal(id){
      const m = document.getElementById(id);
      if(!m) return;
      m.classList.remove('hidden');
      document.documentElement.classList.add('overflow-hidden');
      const closerSel = `[data-close-modal="${id}"]`;
      const closers = m.querySelectorAll(closerSel);
      const onEsc = (e) => { if(e.key === 'Escape'){ closeModal(id); document.removeEventListener('keydown', onEsc); } };
      document.addEventListener('keydown', onEsc);
      closers.forEach((c)=> c.addEventListener('click', () => closeModal(id), { once: true }));
    }
    function closeModal(id){
      const m = document.getElementById(id);
      if(!m) return;
      m.classList.add('hidden');
      document.documentElement.classList.remove('overflow-hidden');
    }
    openers.forEach((el)=>{
      const id = el.getAttribute('data-open-modal');
      if(!id) return;
      el.addEventListener('click', () => openModal(id));
    });
  })();
</script>
